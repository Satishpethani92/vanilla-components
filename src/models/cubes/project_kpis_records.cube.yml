cubes:
  - name: project_kpi_records
    title: Project KPI Records
    sql_alias: pkpd
    data_source: my-db
    sql: >
      SELECT * 
      FROM csdb.kpi_data

    dimensions:
      - name: kpd_id
        sql: kpd_id
        type: number
        primary_key: true
        title: 'KPI Data Record ID'

      - name: ink_id
        sql: ink_id
        type: number
        title: 'Project KPI ID (ink_id)'

      - name: start_date
        sql: start_date
        type: time
        title: 'Start Date'

      - name: end_date
        sql: end_date
        type: time
        title: 'End Date'

      - name: measure
        sql: measure
        type: string
        title: 'Measure'

      - name: actual
        sql: actual
        type: number
        title: 'Actual'

      - name: target
        sql: target
        type: number
        title: 'Target'

      - name: score
        sql: score
        type: number
        title: 'Score'

      - name: status
        sql: status
        type: number
        title: 'Status'

      - name: kpi_type_target
        sql: >
          (
            SELECT kot.kpi_type_target
            FROM csdb.initiative_kpi ink
              JOIN csdb.kpi_org_template kot 
                ON kot.kot_id = ink.kot_id
            WHERE ink.ink_id = {CUBE}.ink_id
          )
        type: string
        title: 'KPI Type Target'

    joins:
      - name: project_kpis
        sql: '{CUBE}.ink_id = {project_kpis}.ink_id'
        relationship: many_to_one
